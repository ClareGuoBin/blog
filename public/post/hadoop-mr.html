<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" href="../images/favicon.ico">
    <link rel="stylesheet" href="../css/code.css" type="text/css" />
    <link rel="stylesheet" href="../css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" />
    <title>Hadoop MR 性能优化|编程小梦|康凯森的技术博客</title>
</head>
<body>
<nav class="navbar navbar-default navbar-static-top" style="opacity: .9" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" >
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">编程小梦</a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li class="active"><a href="/">Blog</a></li>
                
                <li><a href="https://github.com/kangkaisen" target="_blank"  rel="nofollow">GitHub</a></li>
                
                
                <li><a href="http://weibo.com/533234148" target="_blank"  rel="nofollow">WeiBo</a></li>
                
            </ul>
        </div>
    </div>
</nav>
<div class="row" style="padding-top: 60px">
    <div class="container center-block">
        <div class="col-md-1"></div>
        <div class="col-md-10 col-sm-12">
            <div class="panel panel-success">
                <div class="panel-heading">
                    <h1 class="panel-title ">Hadoop MR 性能优化</h1>
                </div>
                <div class="panel-body">
                    <h2 id="影响-mapreduce-的主要因素">影响 MapReduce 的主要因素</h2>
<ul>
<li>硬件因素 ：CPU 磁盘 I/O, 网络带宽， 内存</li>
<li>底层存储系统</li>
<li>输入数据，shuffle 数据 以及输出数据的大小</li>
<li>作业算法： map, reduce, partition, combine, compress</li>
</ul>
<h2 id="潜在影响因素">潜在影响因素</h2>
<ul>
<li>I/O 模式： 直接I/O(本地) 流式I/O（TCP，JDBC）</li>
<li>输入数据解析</li>
<li>输入数据存储</li>
</ul>
<h2 id="性能调优">性能调优</h2>
<ul>
<li>COU利用率</li>
<li>内存占用</li>
<li>磁盘 I/O</li>
<li>网络流量</li>
</ul>
<h2 id="mapred-sitexml">mapred-site.xml</h2>
<h3 id="cpu相关参数">CPU相关参数</h3>
<p>map reduce 任务的最大数目</p>
<h3 id="磁盘i-o相关参数">磁盘I/O相关参数</h3>
<p>是否压缩 编码方式</p>
<h3 id="内存相关参数">内存相关参数</h3>
<ul>
<li>每个JVM 任务的可用内存</li>
<li>每个MR 作业的VM极限值</li>
<li>MR 合并与排序 时 排序区的缓冲区大小</li>
<li>MR 合并与排序 时 map 输出分区数目</li>
</ul>
<h3 id="与网络相关参数">与网络相关参数</h3>
<p>机架感知</p>
<h2 id="hdfs-sitexml">hdfs-site.xml</h2>
<ul>
<li>默认的block 块大小</li>
<li>文件副本数</li>
</ul>
<h2 id="检测-系统瓶颈">检测 系统瓶颈</h2>
<ol>
<li>创建一项基线 ：使用 Hadoop 集群默认配置</li>
<li>分析 Hadoop 计数器， 修改或者调优 某些配置参数的配置</li>
<li>重复第2步，直到作业执行时间 达到最短</li>
</ol>
<h2 id="善于使用linux-相关-命令">善于使用linux 相关 命令</h2>
<h2 id="通过计数器-识别-资源薄弱环节">通过计数器 识别 资源薄弱环节</h2>
<ul>
<li>检查输入数据大小</li>
<li>检查 海量I/O 和网路阻塞</li>
<li>检查 并发任务不足</li>
<li>检查 CPU 过饱和</li>
</ul>
<h2 id="强化-map-和-reduce-任务">强化 map 和 reduce 任务</h2>
<p>在Hadoop 下处理 hdfs 小文件问题的最简单方法是把它们打包成大文件</p>
<p>在shuffle阶段 和 Sort 阶段 提高性能最简单的手段就是压缩排序和合并的数据量，可以 使用 combiner,数据压缩，数据过滤</p>
<h2 id="优化-mapreduce-任务">优化 mapreduce 任务</h2>
<ul>
<li>合理设定Map/Reduce数量</li>
<li>使用Combiner减少中间数据输出</li>
<li>对中间数据和最终结果启用压缩</li>
<li>减少Shuffle过程中写入磁盘的数据</li>
<li>使用正确的 Writable 类型</li>
<li>在代码中捕获所有异常</li>
</ul>
<h2 id="hadoop-最佳实践">Hadoop 最佳实践</h2>
<ul>
<li>EXT4 文件系统</li>
<li>noatime: 禁用文件和目录的访问时间日志</li>
<li>避免使用逻辑卷管理</li>
<li>swap 值降低 或禁用</li>
<li>提高最大打开文件描述符</li>
</ul>

                </div>
                <div class="panel-footer">
                    康凯森
                </div>
            </div>
        </div>
        <div class="col-md-1"></div>
    </div>
</div>
<div class="row" style="padding-top: 60px">
    <div class="container center-block">
        <div class="col-md-1"></div>
        <div class="col-md-10 col-sm-12">
            <div class="ds-thread"
                 data-thread-key=56755fb2f9c70baf0cb4556e
                 data-title=Hadoop MR 性能优化
                 data-url=hadoop-mr>
            </div>
        </div>
        <div class="col-md-1"></div>
    </div>
</div>
</body>
<script src="../js/code.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
    var duoshuoQuery = {short_name:"blogkks"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
</html>